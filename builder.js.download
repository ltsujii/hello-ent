function Builder(e){this.form=e.addClass("json-builder"),this.json=null,this.items=[]}Builder.prototype.init=function(e,t){this.json=e,this.html=this.buildForm(e),this.resetForm();var r=this,a=this.form;a.on("click",".add",function(e){e.preventDefault();var t=$(this),i=t.closest(".array").data("name"),n=r.items[i].clone();t.before(n),a.trigger("change")}),a.on("click",".remove",function(e){e.preventDefault(),$(this).closest(".array").children(".item:last").remove(),a.trigger("change")}),a.on("input","input, textarea",function(){a.trigger("change")}),"function"==typeof t&&t()},Builder.prototype.resetForm=function(){this.form.html(this.html);var e=this,t=this.form.find(".array").get().reverse();$(t).each(function(){var t=$(this),r=t.data("name"),a=t.children(".item");e.items[r]||(e.items[r]=a.clone()),a.remove()})},Builder.prototype.buildForm=function(e,t,r){if(e.type){t=t||"",r=r||"";var a=t.split(".").pop();switch(e.type){case"array":var i=e.items;r=Handlebars.templates.array({name:t,title:a,html:this.buildForm(i,t)});break;case"object":t&&(t+=".");var n=e.properties;for(var s in n)r+=this.buildForm(n[s],t+s);r=Handlebars.templates.object({name:t,title:a,html:r});break;case"string":r=Handlebars.templates.string({name:t,title:a})}return r}},Builder.prototype.setFormValues=function(e,t,r){switch(t=t||this.form,r=r||"",""==r&&this.resetForm(),$.type(e)){case"array":var a=t.find(".array[data-name='"+r+"']"),i=a.find(".add");for(var n in e){var s=this.items[r].clone();this.setFormValues(e[n],s,r),i.before(s)}break;case"object":r&&(r+=".");for(var n in e)this.setFormValues(e[n],t,r+n);break;case"string":t.find("input[name='"+r+"']").val(e)}if(""==r){var o=this.form;o.trigger("change"),$.fn.sortable&&o.find(".array").sortable({containment:"parent",cursor:"row-resize",items:".item",handle:".handle",placeholder:"placeholder",forcePlaceholderSize:!0,scroll:!1,update:function(){o.trigger("change")}})}},Builder.prototype.getFormValuesAsJSON=function(){var e=this.getFormValues();return JSON.stringify(e,null,"  ")},Builder.prototype.getFormValues=function(){var e=this.form,t={};return function e(r,a,i,n){if(r.type){i=i||t,n=n||"";var s=n.split(".").pop();switch(r.type){case"array":i[s]=[];var o=a.find(".item[data-name='"+n+"']"),l=0;o.each(function(){e(r.items,$(this),i[s],n),l++});break;case"object":var c=r.properties,h=$.type(i);"array"==h?i.push({}):""!==s&&(i[s]={}),n&&(n+=".");for(var l in c)e(c[l],a,"array"==h?i[i.length-1]:i[s],n+l);break;case"string":var m=a.find("input[name='"+n+"']");"array"!=$.type(i)?i[s]=m.eq(0).val():m.each(function(){i.push($(this).val())})}}}(this.json,e),t};